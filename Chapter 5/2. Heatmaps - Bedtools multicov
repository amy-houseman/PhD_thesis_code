#Go to https://genome.ucsc.edu/cgi-bin/hgTables and download the NCBI RefSeq table. This has the gene transcripts and the genomic locations.
# Extract and expand the exon coordinates for the gene transcript.
#Then calculate the exon coverage of the gene using bedtools multicov

#!/bin/bash --login
#SBATCH -J AmyHouseman_bedtoolsmulticov
#SBATCH -o %x.stdout.%J.%N
#SBATCH -e %x.stderr.%J.%N
#SBATCH --ntasks=1
#SBATCH --ntasks-per-node=1
#SBATCH -p htc
#SBATCH --account=scw1581
#SBATCH --mail-type=ALL          # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=HousemanA@cardiff.ac.uk     # Where to send mail
#SBATCH --mem-per-cpu=32GB
#SBATCH --time=04:00:00

module purge
module load singularity
module load parallel
module load bedtools

# Set bash error trapping to exit on first error.
set -eu

INPUTBAMS=/path/to/bam/files/and/bai/*.bam
BEDFILE=/path/to/bed/file/of/exon/coordinates/APC_USCS_exonsonly_bases.txt
OUTPUTBEDFILE=/path/to/output/file/APC_UCSC_exons_bases_bedtools_multicov_combined.txt

bedtools multicov -bams $INPUTBAMS -bed $BEDFILE > $OUTPUTBEDFILE
