#BSUB -q long  # depending on the number of files that you will need $
#BSUB -P re_gecip_cancer_colorectal # edit this line
#BSUB -o logs/%J.stdout
#BSUB -e logs/%J.stderr
#BSUB -J "bcftools[1-143]%143"
#BSUB -cwd .
#BSUB -n 1 # this will need to be the same as the number of VEP forks
#BSUB -R "rusage[mem=64000] span[hosts=1]"
#BSUB -M 64000

# Create logging directory
mkdir -p ./logs

# Load modules
module purge
module load bio/BCFtools/1.16
module load tools/parallel/20190222-GCCcore-7.3.0

TOOL=bcftools
FILEIDS=/path/to/IDs/file/no/file/extension/1_ensemblvep_IDs.txt
INPUTVCFVEPPED=/path/to/input/ensembl/vep/annotated/files/{}.genome_annotated.txt
BCFTOOLSOUTPUTVCF=/path/to/output/files/splitvep/{}.genome_annotated_bcftoolsplit.txt
HEADERFILE=/path/to/file/with/ensemblvep/headers/ensembl-vep-headers_withqual_filters.txt
SAMPLENAMEHEADER=/path/to/temporary/file/with/ensemblvep/headers/and/IDs/{}_allvariants_ensembl-vep-headers.txt
BCFTOOLSANDHEADER=/path/to/output/with/bcftools/split/output/and/the/header/added/{}PE_output_GCA_000001405.15_GRCh38_no_alt_analysis_set_allvariants_annotatedVEP_bcftoolssplitvcf_withfullheader.vcf

sed -n "${LSB_JOBINDEX}p" $FILEIDS | parallel -j 1 "$TOOL +split-vep $INPUTVCFVEPPED -f '\t%CHROM\t%POS\t%ID\t%REF\t%ALT\t%QUAL\t%FILTER\t%CSQ[\t%GT][\t%GQ][\t%GQX][\t%DP][\t%DPF][\t%AD][\t%PL]\n' -d -A tab > $BCFTOOLSOUTPUTVCF | cp $HEADERFILE $SAMPLENAMEHEADER && cat $BCFTOOLSOUTPUTVCF >> $SAMPLENAMEHEADER && mv $SAMPLENAMEHEADER $BCFTOOLSANDHEADER"
