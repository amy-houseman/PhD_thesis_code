#!/bin/bash --login
#SBATCH -J AmyHouseman_cutadapt
#SBATCH -o %x.stdout.%J.%N
#SBATCH -e %x.stderr.%J.%N
#SBATCH --ntasks=1
#SBATCH --ntasks-per-node=1
#SBATCH --account=scw1581
#SBATCH --mail-type=ALL          # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=HousemanA@cardiff.ac.uk     # Where to send mail
#SBATCH --array=1-23
#SBATCH --time=12:00:00
#SBATCH --qos=maxjobs100
#SBATCH --partition=htc

module purge
module load cutadapt
module load parallel

# Set bash error trapping to exit on first error.
set -eu

EXOMEIDS=/file/with/the/file/IDs/not/with/the/file/extensions/.txt
INPUTFASTQFORWARD=/input/gzipped/forward/fastq/file/{}1.fastq.gz
INPUTFASTQREVERSE=/input/gzipped/reverse/fastq/file/{}2.fastq.gz
#These adaptors are specific to this dataset.
FORWARDADAPTER=AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT
REVERSEADAPTER=TTACTATGCCGCTGGTGGCTCTAGATGTGAGAAAGGGATGTGCTGCGAGAAGGCTAGA

OUTPUTFASTQFORWARD=/output/gzipped/trimmed/forward/fastq/file/{}1.cutadapt-trimmed.fq.gz
OUTPUTFASTQREVERSE=/output/gzipped/trimmed/reverse/fastq/file/{}2.cutadapt-trimmed.fq.gz

TOOSHORTFORWARD=/output/gzipped/removed/forward/reads/for/being/too/short/{}1.cutadapt-tooshort.fq.gz
TOOSHORTREVERSE=/output/gzipped/removed/reverse/reads/for/being/too/short/{}2.cutadapt-tooshort.fq.gz

TXTREPORT=/output/text/report/for/the/retained/and/removed/reads/{}cutadapt.txt

cd /scratch/c.c21087028/

sed -n "${SLURM_ARRAY_TASK_ID}p" $EXOMEIDS | parallel -j 1 "cutadapt -q 30 -m 35 --too-short-output $TOOSHORTFORWARD --too-short-paired-output $TOOSHORTREVERSE -o $OUTPUTFASTQFORWARD -p $OUTPUTFASTQREVERSE $INPUTFASTQFORWARD $INPUTFASTQREVERSE > $TXTREPORT"
